---
# On utilise un template afin de modifier la configuration de nginx afin qu'il active PHP
- name: 'Nginx > Activer PHP & Changer le port du serveur local pour {{ serveur_port }}'
  ansible.builtin.template:
    src: ./templates/default.j2
    dest: /etc/nginx/sites-available/default
  notify: Recharger Nginx suite √† une modification de configuration

# üëå Bonne pratique, m√™me si je n'utilise pas le template, je conserve le fichier de configuration original
# üß† √† noter que "lineinfile" s'assure que la ligne est pr√©sente, ce qui √©vite de la redondance si le script est relanc√© plusieurs fois

- name: 'PHP > Configuration > Augmenter la RAM √† {{ php_limite_ram }}'
  ansible.builtin.lineinfile:
    path: /etc/php/8.2/fpm/php.ini
    # Peut importe la m√©moire actuelle, on remplace
    regexp: '^memory_limit ='
    line: 'memory_limit = {{ php_limite_ram }}'
  notify: Recharger PHP suite √† une modification de configuration

- name: 'PHP > Configuration > Activer les modules'
  ansible.builtin.lineinfile:
    path: /etc/php/8.2/fpm/php.ini
    # Peut importe la m√©moire actuelle, on remplace
    regexp: '^;extension={{ item }}'
    line: 'extension={{ item }}'
  loop:
    - curl
    - intl
    - mbstring
    - pdo_mysql
  notify: Recharger PHP suite √† une modification de configuration

# V√©rifier le fichier de configuration √† la main
#     cat /etc/php/8.2/fpm/php.ini
...

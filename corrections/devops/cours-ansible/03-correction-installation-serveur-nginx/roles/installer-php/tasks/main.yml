---
# Le repo de PHP doit √™tre ajout√© aux sources apt
#   üîç https://docs.ansible.com/ansible/latest/collections/ansible/builtin/apt_repository_module.html
- name: Ajouter le repo php √† la liste des sources dans apt
  ansible.builtin.apt_repository:
    # Ne pas oublier les guillemets, car le repo contient le caract√®re :
    repo: 'ppa:ondrej/php'
    state: present

- name: Mise √† jour de la liste des paquets, afin de rajouter le paquet PHP
  apt:
    update_cache: yes
    cache_valid_time: 3600

- name: Installation de PHP
  apt:
    # Liste des packages officiels avec les versions, et les modules
    #   üîç https://launchpad.net/~ondrej/+archive/ubuntu/php/+index?batch=75
    name: php8.2
    update_cache: yes
    state: latest
    cache_valid_time: 3600

# - name: Installation des modules PHP en une fois (une t√¢che)
#   apt:
#     pkg:
#     - php8.2-cli
#     - php8.2-bz2
#     - php8.2-curl
#     - php8.2-fpm
#     - php8.2-intl
#     - php8.2-mbstring
#     update_cache: yes
#     state: latest
#     cache_valid_time: 3600

- name: Installation des modules PHP de mani√®re plus visible (t√¢ches s√©par√©es)
  apt:
    name: '{{ item }}'
    update_cache: yes
    state: latest
    cache_valid_time: 3600
  loop:
    - php8.2-cli
    - php8.2-bz2
    - php8.2-curl
    - php8.2-fpm
    - php8.2-intl
    - php8.2-mbstring
  
- name: 'Maintenance des paquets : Supprimer les packages inutiles du cache'
  apt:
    autoclean: yes

- name: 'Maintenance des paquets : Supprimer les d√©pendances qui ne sont plus utiles'
  apt:
    autoremove: yes

# üëå Bonne pratique, ne pas h√©siter √† stocker les commandes manuelles, au cas ou
#     V√©rifier le status de PHP
#         /etc/init.d/php8.2-fpm status
#     Forcer le lancement de PHP
#         sudo service php8.2-fpm start
- name: "Lancer le service PHP, permet de v√©rifier s'il s'ex√©cute correctement"
  ansible.builtin.service:
    name: php8.2-fpm
    state: started
...
